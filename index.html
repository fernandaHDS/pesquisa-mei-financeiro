<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa MEI - Gest√£o Financeira</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            font-weight: 400;
            color: #334155;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 32px 64px rgba(0,0,0,0.12);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            opacity: 0.9;
        }

        .header * {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.5em; 
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .header p {
            font-size: 1.1em; 
            opacity: 0.95;
            font-weight: 400;
            line-height: 1.6;
        }
        .header p small {
            font-size: 0.9em;
        }

        .form-content {
            padding: 24px; 
        }
        @media (min-width: 600px) {
            .form-content {
                padding: 48px;
            }
            .header h1 {
                font-size: 2.75em;
            }
             .header p {
                font-size: 1.125em;
            }
        }


        .section {
            margin: 32px 0; 
            padding: 24px; 
            background: #f8fafc;
            border-radius: 20px;
            border-left: 4px solid #4f46e5;
            box-shadow: 0 4px 16px rgba(0,0,0,0.04);
        }

        .section h2 {
            color: #1e293b;
            margin-bottom: 20px; 
            font-size: 1.6em; 
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .question {
            margin: 24px 0; 
            padding: 20px; 
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            border: 1px solid #e2e8f0;
        }

        .question h3 {
            color: #334155;
            margin-bottom: 16px; 
            font-size: 1.15em; 
            line-height: 1.5;
            font-weight: 500;
            display: flex; 
            align-items: flex-start; 
        }

        .question-number {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            min-width: 28px; 
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875em;
            font-weight: 600;
            margin-right: 12px;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
            flex-shrink: 0; 
        }
        .question h3 span:not(.question-number) { 
            flex-grow: 1;
        }


        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px; 
        }

        .option {
            display: flex;
            align-items: center;
            padding: 14px 18px; 
            background: #f8fafc;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            font-weight: 400;
            font-size: 0.95em; 
        }

        .option:hover {
            background: #e2e8f0;
            border-color: #4f46e5;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
        }

        .option input[type="radio"], .option input[type="checkbox"] {
            margin-right: 14px;
            transform: scale(1.1); 
            accent-color: #4f46e5;
            flex-shrink: 0;
        }
        .option input[type="text"] {
            flex-grow: 1; 
            min-width: 100px; 
        }


        .scale-options {
            display: flex;
            justify-content: space-around; 
            align-items: center;
            margin: 20px 0; 
            padding: 20px; 
            background: #f8fafc;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            flex-wrap: wrap; 
        }

        .scale-item {
            text-align: center;
            flex: 1;
            min-width: 40px; 
            padding: 5px;
        }

        .scale-item input[type="radio"] {
            margin-bottom: 8px; 
            transform: scale(1.3); 
            accent-color: #4f46e5;
        }

        .scale-item label {
            font-size: 0.85em; 
            color: #64748b;
            font-weight: 500;
            display: block; 
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px; 
            font-size: 0.85em; 
            color: #64748b;
            font-weight: 500;
            padding: 0 5px; 
        }
         .scale-labels span:first-child {
            text-align: left;
        }
        .scale-labels span:last-child {
            text-align: right;
        }

        textarea, input[type="text"], input[type="number"], input[type="tel"], input[type="email"] { 
            width: 100%;
            padding: 14px 18px; 
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95em; 
            font-family: inherit;
            transition: all 0.2s ease;
            margin-top: 10px; 
            font-weight: 400;
            background-color: #fff; 
            color: #334155; 
        }

        textarea:focus, input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        textarea {
            min-height: 100px; 
            resize: vertical;
        }

        .priority-high { border-left-color: #dc2626; }
        .priority-medium { border-left-color: #d97706; }
        .priority-low { border-left-color: #059669; }

        .insight-box {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 24px; 
            border-radius: 16px;
            margin: 20px 0; 
            position: relative;
            overflow: hidden;
        }

        .insight-box::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px; 
            height: 80px; 
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(25px, -25px); 
        }

        .insight-box h4 {
            margin-bottom: 10px; 
            font-weight: 600;
            position: relative;
            z-index: 1;
            font-size: 1.1em;
        }

        .insight-box p {
            line-height: 1.6;
            position: relative;
            z-index: 1;
            font-weight: 400;
            font-size: 0.95em;
        }

        .submit-section {
            text-align: center;
            margin: 32px 0 0; 
            padding: 32px; 
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 0 0 20px 20px; 
            color: white;
        }
         .container > .submit-section { 
             border-radius: 0 0 20px 20px;
         }
         .form-content > .submit-section { 
             border-radius: 20px; 
             margin-bottom: 0;
         }


        .submit-section h3 {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.25em;
        }
        .submit-section p {
            font-size: 0.95em;
            margin-bottom: 16px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 14px 40px; 
            border: none;
            border-radius: 12px;
            font-size: 1.05em; 
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(79, 70, 229, 0.4);
        }
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }


        /* Modal Styles */
        .feedback-modal {
            position: fixed;
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); 
            justify-content: center;
            align-items: center;
            display: none; 
        }
        .feedback-modal-content {
            background-color: #fff;
            margin: auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            width: 90%;
            max-width: 450px;
            text-align: center;
        }
        .feedback-modal-content p {
            margin-bottom: 20px;
            font-size: 1.1em;
            line-height: 1.5;
            color: #334155;
        }
        .feedback-modal-content button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background-color: #4f46e5;
            color: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }
        .feedback-modal-content button:hover {
            background-color: #4338ca;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Pesquisa: MEI e Gest√£o Financeira</h1>
            <p>Ajude-nos a entender como voc√™ gerencia as finan√ßas do seu neg√≥cio</p>
            <p><small>‚è±Ô∏è 5 minutos ‚Ä¢ Suas respostas s√£o confidenciais</small></p>
        </div>

        <div class="form-content">
            <form id="meiResearchForm">
                
                <div class="section priority-low">
                    <h2>üë§ Sobre Voc√™ e Seu Neg√≥cio</h2>
                    <div class="question">
                        <h3><span class="question-number">1</span><span>Qual seu ramo de atividade?</span></h3>
                        <div class="options">
                            <label class="option"><input type="radio" name="q1" value="servicos"> Servi√ßos (cabeleleiro, est√©tica, consultoria, etc.)</label>
                            <label class="option"><input type="radio" name="q1" value="comercio"> Com√©rcio (loja f√≠sica, vendas)</label>
                            <label class="option"><input type="radio" name="q1" value="alimentacao"> Alimenta√ß√£o (delivery, lanchonete, etc.)</label>
                            <label class="option"><input type="radio" name="q1" value="digital"> Digital (design, marketing, desenvolvimento)</label>
                            <label class="option"><input type="radio" name="q1" value="outros" id="q1_outros_radio"> Outros: <input type="text" name="q1_outros_text" id="q1_outros_text" placeholder="Especifique..." style="width: auto; display: inline-block; margin-left: 10px; padding: 8px 10px; font-size: 0.9em; border-radius: 8px;"></label>
                        </div>
                    </div>
                    <div class="question"><h3><span class="question-number">2</span><span>H√° quanto tempo voc√™ √© MEI?</span></h3><div class="options"><label class="option"><input type="radio" name="q2" value="menos6meses"> Menos de 6 meses</label><label class="option"><input type="radio" name="q2" value="6meses1ano"> 6 meses a 1 ano</label><label class="option"><input type="radio" name="q2" value="1a3anos"> 1 a 3 anos</label><label class="option"><input type="radio" name="q2" value="mais3anos"> Mais de 3 anos</label></div></div>
                    <div class="question"><h3><span class="question-number">3</span><span>Qual sua faixa de faturamento mensal?</span></h3><div class="options"><label class="option"><input type="radio" name="q3" value="ate2mil"> At√© R$ 2.000</label><label class="option"><input type="radio" name="q3" value="2a5mil"> R$ 2.001 a R$ 5.000</label><label class="option"><input type="radio" name="q3" value="5a8mil"> R$ 5.001 a R$ 8.100 (limite MEI)</label></div></div>
                </div>
                <div class="section priority-high">
                    <h2>üò∞ Controle Financeiro Atual</h2>
                    <div class="question"><h3><span class="question-number">4</span><span>Como voc√™ controla suas finan√ßas hoje? (Marque todas que se aplicam)</span></h3><div class="options"><label class="option"><input type="checkbox" name="q4" value="caderno"> Caderno/papel</label><label class="option"><input type="checkbox" name="q4" value="planilha"> Planilha Excel/Google Sheets</label><label class="option"><input type="checkbox" name="q4" value="app_bancario"> App do banco</label><label class="option"><input type="checkbox" name="q4" value="sistema_gestao"> Sistema de gest√£o online</label><label class="option"><input type="checkbox" name="q4" value="memoria"> S√≥ na mem√≥ria/cabe√ßa</label><label class="option"><input type="checkbox" name="q4" value="nao_controlo"> N√£o controlo (seja honesto!)</label></div></div>
                    <div class="question"><h3><span class="question-number">5</span><span>Voc√™ sabe exatamente quanto lucrou no m√™s passado?</span></h3><div class="options"><label class="option"><input type="radio" name="q5" value="sim_exato"> Sim, sei o valor exato</label><label class="option"><input type="radio" name="q5" value="mais_ou_menos"> Mais ou menos, uma estimativa</label><label class="option"><input type="radio" name="q5" value="nao_sei"> N√£o, n√£o sei</label></div></div>
                    <div class="question"><h3><span class="question-number">6</span><span>Com que frequ√™ncia voc√™ atualiza seu controle financeiro?</span></h3><div class="options"><label class="option"><input type="radio" name="q6" value="diario"> Todo dia</label><label class="option"><input type="radio" name="q6" value="semanal"> Uma vez por semana</label><label class="option"><input type="radio" name="q6" value="mensal"> Uma vez por m√™s</label><label class="option"><input type="radio" name="q6" value="quando_lembro"> Quando lembro</label><label class="option"><input type="radio" name="q6" value="nunca"> Quase nunca</label></div></div>
                    <div class="question"><h3><span class="question-number">7</span><span>Qual sua MAIOR dificuldade com controle financeiro?</span></h3><textarea name="q7" placeholder="Seja espec√≠fico: falta de tempo, n√£o sei como fazer, esque√ßo de anotar, etc."></textarea></div>
                </div>
                <div class="section priority-medium">
                    <h2>üì± Seu Uso de Tecnologia</h2>
                    <div class="question"><h3><span class="question-number">8</span><span>Com que frequ√™ncia voc√™ usa WhatsApp para trabalho?</span></h3><div class="scale-options"><div class="scale-item"><input type="radio" name="q8" value="1" id="q8_1"><label for="q8_1">1</label></div><div class="scale-item"><input type="radio" name="q8" value="2" id="q8_2"><label for="q8_2">2</label></div><div class="scale-item"><input type="radio" name="q8" value="3" id="q8_3"><label for="q8_3">3</label></div><div class="scale-item"><input type="radio" name="q8" value="4" id="q8_4"><label for="q8_4">4</label></div><div class="scale-item"><input type="radio" name="q8" value="5" id="q8_5"><label for="q8_5">5</label></div></div><div class="scale-labels"><span>Nunca</span><span>Todo dia</span></div></div>
                    <div class="question"><h3><span class="question-number">9</span><span>Voc√™ costuma mandar √°udios no WhatsApp?</span></h3><div class="options"><label class="option"><input type="radio" name="q9" value="sempre"> Sempre, prefiro √°udio a texto</label><label class="option"><input type="radio" name="q9" value="as_vezes"> √Äs vezes, depende da situa√ß√£o</label><label class="option"><input type="radio" name="q9" value="raramente"> Raramente, prefiro digitar</label><label class="option"><input type="radio" name="q9" value="nunca"> Nunca mando √°udios</label></div></div>
                    <div class="question"><h3><span class="question-number">10</span><span>Em que situa√ß√µes voc√™ pensa 'tenho que lembrar de anotar isso' (gastos ou dinheiro que recebeu), mas √†s vezes esquece (Marque todas que se aplicam)</span></h3><div class="options"><label class="option"><input type="checkbox" name="q10" value="atendendo_cliente"> Enquanto atendo cliente</label><label class="option"><input type="checkbox" name="q10" value="no_transito"> No tr√¢nsito/dirigindo</label><label class="option"><input type="checkbox" name="q10" value="fora_escritorio"> Fora do escrit√≥rio/casa</label><label class="option"><input type="checkbox" name="q10" value="final_do_dia"> No final do dia</label><label class="option"><input type="checkbox" name="q10" value="momento_compra"> No momento da compra/venda</label></div></div>
                </div>
                <div class="section priority-high">
                    <h2>üí° Testando a Ideia</h2>
                    <div class="insight-box"><h4>üí≠ Imagine este cen√°rio:</h4><p>Voc√™ poderia controlar suas finan√ßas mandando √°udios pelo WhatsApp, de forma muito mais pr√°tica e r√°pida. Sem precisar digitar, sem complica√ß√£o - s√≥ falando seus gastos e receitas quando acontecem. Por exemplo: "Gastei 200 reais com gasolina" ou "Recebi 500 reais por um servi√ßo". O aplicativo organizaria tudo automaticamente e te daria relat√≥rios simples sobre a situa√ß√£o da sua empresa.</p></div>
                    <div class="question"><h3><span class="question-number">11</span><span>O quanto essa solu√ß√£o seria √∫til para voc√™?</span></h3><div class="scale-options"><div class="scale-item"><input type="radio" name="q11" value="1" id="q11_1"><label for="q11_1">1</label></div><div class="scale-item"><input type="radio" name="q11" value="2" id="q11_2"><label for="q11_2">2</label></div><div class="scale-item"><input type="radio" name="q11" value="3" id="q11_3"><label for="q11_3">3</label></div><div class="scale-item"><input type="radio" name="q11" value="4" id="q11_4"><label for="q11_4">4</label></div><div class="scale-item"><input type="radio" name="q11" value="5" id="q11_5"><label for="q11_5">5</label></div></div><div class="scale-labels"><span>Nada √∫til</span><span>Muito √∫til</span></div></div>
                    <div class="question"><h3><span class="question-number">12</span><span>Voc√™ usaria uma ferramenta assim regularmente?</span></h3><div class="options"><label class="option"><input type="radio" name="q12" value="com_certeza"> Com certeza, todo dia</label><label class="option"><input type="radio" name="q12" value="provavelmente"> Provavelmente sim</label><label class="option"><input type="radio" name="q12" value="talvez"> Talvez, dependeria</label><label class="option"><input type="radio" name="q12" value="provavelmente_nao"> Provavelmente n√£o</label><label class="option"><input type="radio" name="q12" value="nunca"> Nunca usaria</label></div></div>
                    <div class="question"><h3><span class="question-number">13</span><span>Qual seria sua maior preocupa√ß√£o com essa solu√ß√£o? (Marque todas que se aplicam)</span></h3><div class="options"><label class="option"><input type="checkbox" name="q13" value="privacidade"> Privacidade/seguran√ßa dos dados</label><label class="option"><input type="checkbox" name="q13" value="app_errar"> O aplicativo n√£o entender/categorizar errado</label><label class="option"><input type="checkbox" name="q13" value="custo"> Custo mensal</label><label class="option"><input type="checkbox" name="q13" value="complexidade"> Ser muito complexo de usar</label><label class="option"><input type="checkbox" name="q13" value="dependencia"> Depend√™ncia de internet/WhatsApp</label><label class="option"><input type="checkbox" name="q13" value="nenhuma"> Nenhuma preocupa√ß√£o espec√≠fica</label></div></div>
                    <div class="question"><h3><span class="question-number">14</span><span>Quanto voc√™ pagaria por m√™s por essa solu√ß√£o?</span></h3><div class="options"><label class="option"><input type="radio" name="q14" value="gratis"> S√≥ usaria se fosse gr√°tis</label><label class="option"><input type="radio" name="q14" value="ate20"> At√© R$ 20</label><label class="option"><input type="radio" name="q14" value="20a50"> R$ 20 a R$ 50</label><label class="option"><input type="radio" name="q14" value="50a100"> R$ 50 a R$ 100</label><label class="option"><input type="radio" name="q14" value="mais100"> Mais de R$ 100 (se realmente funcionasse)</label></div></div>
                </div>
                <div class="section priority-medium">
                    <h2>üîç Descobrindo Mais Oportunidades</h2>
                    <div class="question"><h3><span class="question-number">15</span><span>Que outras funcionalidades seriam importantes para voc√™? (Marque todas que se aplicam)</span></h3><div class="options"><label class="option"><input type="checkbox" name="q15" value="alertas_ia"> Alertas inteligentes ("Cuidado, voc√™ vai ficar sem dinheiro")</label><label class="option"><input type="checkbox" name="q15" value="coaching"> Dicas para economizar/ganhar mais</label><label class="option"><input type="checkbox" name="q15" value="comparacao"> Compara√ß√£o com outros neg√≥cios similares</label><label class="option"><input type="checkbox" name="q15" value="previsao"> Previs√£o de faturamento futuro</label><label class="option"><input type="checkbox" name="q15" value="fiscal"> Ajuda com quest√µes fiscais/impostos</label><label class="option"><input type="checkbox" name="q15" value="familia"> Permitir fam√≠lia/funcion√°rios tamb√©m mandarem √°udios</label></div></div>
                    <div class="question"><h3><span class="question-number">16</span><span>Qual seria o momento ideal para voc√™ receber relat√≥rios/alertas?</span></h3><div class="options"><label class="option"><input type="radio" name="q16" value="manha"> Manh√£ (planejamento do dia)</label><label class="option"><input type="radio" name="q16" value="almoco"> Meio-dia (pausa almo√ßo)</label><label class="option"><input type="radio" name="q16" value="tarde"> Final da tarde</label><label class="option"><input type="radio" name="q16" value="noite"> Noite (balan√ßo do dia)</label><label class="option"><input type="radio" name="q16" value="weekend"> Final de semana</label></div></div>
                    <div class="question"><h3><span class="question-number">17</span><span>Se voc√™ pudesse ter UMA funcionalidade m√°gica para gest√£o financeira, qual seria?</span></h3><textarea name="q17" placeholder="Seja criativo! Exemplo: 'Que a IA me avisasse antes de eu fazer uma compra ruim' ou 'Que calculasse automaticamente quanto posso me pagar de sal√°rio'"></textarea></div>
                </div>
                <div class="section priority-low">
                    <h2>üéØ Para Finalizar</h2>
                    <div class="question"><h3><span class="question-number">18</span><span>Voc√™ participaria de um teste beta gratuito por 30 dias?</span></h3><div class="options"><label class="option"><input type="radio" name="q18" value="sim_definitivo"> Sim, com certeza!</label><label class="option"><input type="radio" name="q18" value="sim_talvez"> Sim, dependendo de quando</label><label class="option"><input type="radio" name="q18" value="nao_tempo"> N√£o, n√£o tenho tempo</label><label class="option"><input type="radio" name="q18" value="nao_interesse"> N√£o, n√£o me interessa</label></div></div>
                    <div class="question"><h3><span class="question-number">19</span><span>Deixe seu WhatsApp se quiser participar do beta ou receber updates:</span></h3><input type="tel" name="q19" placeholder="(11) 99999-9999 - Opcional"></div>
                    <div class="question"><h3><span class="question-number">20</span><span>Algum coment√°rio adicional ou sugest√£o?</span></h3><textarea name="q20" placeholder="Qualquer coisa que possa ajudar a melhorar a ideia..."></textarea></div>
                </div>


                <div class="submit-section">
                    <h3>Obrigado por participar! üôè</h3>
                    <p>Suas respostas v√£o ajudar a criar uma ferramenta que realmente resolva os problemas dos MEIs brasileiros.</p>
                    <button type="submit" class="submit-btn" id="submitButton">Enviar Respostas</button>
                </div>
            </form>
        </div>
    </div>

    <div id="feedbackModal" class="feedback-modal">
        <div class="feedback-modal-content">
            <p id="feedbackModalMessage"></p>
            <button id="feedbackModalCloseButton">Fechar</button>
        </div>
    </div>

    <script>
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycby1aQ77lFVId8wcaLrnaABhWzWYtWkFJosTBfQNZRwsdcv1tFc_z5fLqCfxkR4usZDlaw/exec'; // <-- MUITO IMPORTANTE: ATUALIZE ESTA LINHA!!!
        const researchForm = document.getElementById('meiResearchForm');
        const submitButton = document.getElementById('submitButton');
        
        const feedbackModal = document.getElementById('feedbackModal');
        const feedbackModalMessage = document.getElementById('feedbackModalMessage');
        const feedbackModalCloseButton = document.getElementById('feedbackModalCloseButton');

        feedbackModalCloseButton.addEventListener('click', () => {
            feedbackModal.style.display = 'none';
        });
        window.addEventListener('click', (event) => {
            if (event.target == feedbackModal) {
                feedbackModal.style.display = 'none';
            }
        });

        function showModal(message, isSuccess = true) {
            feedbackModalMessage.textContent = message;
            feedbackModal.style.display = 'flex';
        }

        researchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            
            const formData = new FormData(this);
            const responses = {};
            
            const q1OutrosRadio = document.getElementById('q1_outros_radio');
            const q1OutrosText = document.getElementById('q1_outros_text').value.trim();

            for (let [key, value] of formData.entries()) {
                let processedValue = value;
                if (key === 'q1' && value === 'outros' && q1OutrosRadio.checked) {
                    processedValue = q1OutrosText ? `Outros: ${q1OutrosText}` : 'Outros (n√£o especificado)';
                }
                if (key === 'q1_outros_text') continue;

                if (responses[key]) {
                    if (Array.isArray(responses[key])) {
                        responses[key].push(processedValue);
                    } else {
                        responses[key] = [responses[key], processedValue];
                    }
                } else {
                    responses[key] = processedValue;
                }
            }
            
            responses.timestamp = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });
            
            fetch(GOOGLE_SHEETS_URL, {
                method: 'POST',
                body: JSON.stringify(responses) 
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                         throw new Error(`Erro do Servidor: ${response.status} ${response.statusText} - ${text || 'Sem detalhes'}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data && data.result === 'success') {
                    showModal('‚úÖ Respostas enviadas com sucesso! Obrigado por participar da pesquisa.');
                    this.reset();
                    const formElements = Array.from(this.elements);
                    formElements.forEach(input => {
                        if (input.name) {
                             const storageKeyBase = 'pesquisa_mei_' + input.name;
                             localStorage.removeItem(storageKeyBase);
                             localStorage.removeItem(storageKeyBase + '_' + input.value);
                        }
                    });

                } else {
                    console.error('Erro retornado pelo script:', data ? data.error : 'Resposta inv√°lida do servidor.');
                    showModal(`‚ùå Erro no envio: ${data && data.error ? data.error : 'Resposta inv√°lida do servidor.'}. Verifique o console.`, false);
                }
            })
            .catch(error => {
                console.error('Erro no fetch:', error);
                let userMessage = `‚ùå Erro cr√≠tico no envio: ${error.message}.`;
                if (error.message && error.message.includes('401')) {
                   userMessage += " O erro 401 (Unauthorized) geralmente significa que a implanta√ß√£o do Apps Script n√£o est√° configurada para 'Qualquer pessoa'. Por favor, verifique novamente a implanta√ß√£o.";
                } else {
                   userMessage += " Verifique o console para detalhes e se o Google Apps Script est√° configurado corretamente (CORS, implanta√ß√£o).";
                }
                showModal(userMessage, false);
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.textContent = 'Enviar Respostas';
            });
        });
        
        const formElements = Array.from(researchForm.elements).filter(el => el.name);

        function loadFormFromLocalStorage() { 
            formElements.forEach(input => {
                const baseKey = 'pesquisa_mei_' + input.name;
                let storageKey = baseKey;

                if (input.type === 'radio') {
                    const savedValue = localStorage.getItem(baseKey); 
                    if (savedValue && input.value === savedValue) {
                        input.checked = true;
                    }
                } else if (input.type === 'checkbox') {
                    storageKey = baseKey + '_' + input.value; 
                    const savedValue = localStorage.getItem(storageKey);
                    if (savedValue === 'true') {
                        input.checked = true;
                    }
                } else { 
                    const savedValue = localStorage.getItem(storageKey);
                    if (savedValue !== null) {
                        input.value = savedValue;
                    }
                }
            });
        }

        function saveFormToLocalStorage(inputChanged) {
            const baseKey = 'pesquisa_mei_' + inputChanged.name;
            let storageKey = baseKey;

            if (inputChanged.type === 'radio') {
                if (inputChanged.checked) {
                    localStorage.setItem(baseKey, inputChanged.value); 
                }
            } else if (inputChanged.type === 'checkbox') {
                storageKey = baseKey + '_' + inputChanged.value;
                if (inputChanged.checked) {
                    localStorage.setItem(storageKey, 'true');
                } else {
                    localStorage.removeItem(storageKey);
                }
            } else { 
                 if (inputChanged.value) {
                    localStorage.setItem(storageKey, inputChanged.value);
                } else {
                    localStorage.removeItem(storageKey); 
                }
            }
        }

        formElements.forEach(input => {
            input.addEventListener('change', (e) => saveFormToLocalStorage(e.target));
            if (input.type === 'text' || input.tagName.toLowerCase() === 'textarea' || input.type === 'tel') {
                 input.addEventListener('input', (e) => saveFormToLocalStorage(e.target));
            }
        });
        
        loadFormFromLocalStorage(); 
    </script>
</body>
</html>
